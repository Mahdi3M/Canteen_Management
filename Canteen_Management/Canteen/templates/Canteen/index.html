{% extends 'base.html' %}
{% load static %}

{% block main %}
<main id="main" class="main">

    <div class="pagetitle">
      <h1>Statistics</h1>
    </div><!-- End Page Title -->

    <section class="section dashboard">
      <div class="row">

        <!-- Left side columns -->
        <div class="col-lg-12">
          <div class="row">

            <!-- Sales Card -->
            <div class="col-xxl-4 col-md-6">
              <div class="card info-card sales-card">

                <div class="filter">
                  <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                    <li class="dropdown-header text-start">
                      <h6>Filter</h6>
                    </li>
                    <li><button class="dropdown-item" type="button" onclick="selectSales('Today')">Today</button></li>
                    <li><button class="dropdown-item" type="button" onclick="selectSales('This Week')">This Week</button></li>
                    <li><button class="dropdown-item" type="button" onclick="selectSales('This Month')">This Month</button></li>
                  </ul>
                </div>

                <div class="card-body">
                  <h5 class="card-title sales-title">Sales <span>| Today</span></h5>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-cart"></i>
                    </div>
                    <div class="ps-3">
                      <h6 class="sales-total">{{ daily.total_sales }}</h6>
                    </div>
                  </div>
                </div>

              </div>
            </div><!-- End Sales Card -->

            <!-- Revenue Card -->
            <div class="col-xxl-4 col-md-6">
              <div class="card info-card revenue-card">

                <div class="filter">
                  <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                    <li class="dropdown-header text-start">
                      <h6>Filter</h6>
                    </li>
                    <li><button class="dropdown-item" type="button" onclick="selectRevenue('Today')">Today</button></li>
                    <li><button class="dropdown-item" type="button" onclick="selectRevenue('This Week')">This Week</button></li>
                    <li><button class="dropdown-item" type="button" onclick="selectRevenue('This Month')">This Month</button></li>
                  </ul>
                </div>

                <div class="card-body">
                  <h5 class="card-title revenue-title">Revenue <span>| This Week</span></h5>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <span class="taka-symbol">&#2547;</span>
                    </div>
                    <div class="ps-3">
                      <h6 class="revenue-total">à§³{{ weekly.total_revenue }}</h6>
                    </div>
                  </div>
                </div>

              </div>
            </div><!-- End Revenue Card -->

            <!-- Customers Card -->
            <div class="col-xxl-4 col-xl-12">

              <div class="card info-card customers-card">

                <div class="filter">
                  <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                    <li class="dropdown-header text-start">
                      <h6>Filter</h6>
                    </li>
                    <li><button class="dropdown-item" type="button" onclick="selectCustomer('Today')">Today</button></li>
                    <li><button class="dropdown-item" type="button" onclick="selectCustomer('This Week')">This Week</button></li>
                    <li><button class="dropdown-item" type="button" onclick="selectCustomer('This Month')">This Month</button></li>
                  </ul>
                </div>

                <div class="card-body">
                  <h5 class="card-title customer-title">Customers <span>| This Month</span></h5>

                  <div class="d-flex align-items-center">
                    <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                      <i class="bi bi-people"></i>
                    </div>
                    <div class="ps-3">
                      <h6 class="customer-total">{{ monthly.total_customer }}</h6>
                    </div>
                  </div>

                </div>
              </div>

            </div><!-- End Customers Card -->

            <!-- Reports -->
            <div class="col-12">
              <div class="card">

                <div class="filter">
                  <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                    <li class="dropdown-header text-start">
                      <h6>Filter</h6>
                    </li>
                    <li><button class="dropdown-item" type="button" onclick="selectReport('Today')">Today</button></li>
                    <li><button class="dropdown-item" type="button" onclick="selectReport('This Week')">This Week</button></li>
                    <li><button class="dropdown-item" type="button" onclick="selectReport('This Month')">This Month</button></li>
                  </ul>
                </div>
                
                <div class="card-body">
                  <h5 class="card-title">Reports <span>/Today</span></h5>

                  <!-- Line Chart -->
                  <div id="reportsChart"></div>

                  <script>
                    // Initialize the chart with default empty data
                    let chart = null;
                
                    function selectReport(value) {
                      if (chart) {
                        chart.destroy();
                      }
                
                      // Update the chart data
                      let sales_data, revenue_data, customer_data, time_data;
                      if (value == "Today") {
                        sales_data = {{ daily.sales|safe }};
                        revenue_data = {{ daily.revenue|safe }};
                        customer_data = {{ daily.customer|safe }};
                        time_data = {{ daily.time|safe }};
                      }
                      if (value == "This Week") {
                        sales_data = {{ weekly.sales|safe }};
                        revenue_data = {{ weekly.revenue|safe }};
                        customer_data = {{ weekly.customer|safe }};
                        time_data = {{ weekly.time|safe }};
                      }
                      if (value == "This Month") {
                        sales_data = {{ monthly.sales|safe }};
                        revenue_data = {{ monthly.revenue|safe }};
                        customer_data = {{ monthly.customer|safe }};
                        time_data = {{ monthly.time|safe }};
                      }
                
                      // Draw the chart with updated data
                      chart = new ApexCharts(document.querySelector("#reportsChart"), {
                        series: [{
                          name: 'Sales',
                          data: sales_data,
                        }, {
                          name: 'Revenue/100Tk',
                          data: revenue_data,
                        }, {
                          name: 'Customers',
                          data: customer_data,
                        }],
                        chart: {
                          height: 350,
                          type: 'area',
                          toolbar: {
                            show: false
                          },
                        },
                        markers: {
                          size: 4
                        },
                        colors: ['#4154f1', '#2eca6a', '#ff771d'],
                        fill: {
                          type: "gradient",
                          gradient: {
                            shadeIntensity: 1,
                            opacityFrom: 0.3,
                            opacityTo: 0.4,
                            stops: [0, 90, 100]
                          }
                        },
                        dataLabels: {
                          enabled: false
                        },
                        stroke: {
                          curve: 'smooth',
                          width: 2
                        },
                        xaxis: {
                          type: 'datetime',
                          categories: time_data,
                        },
                        tooltip: {
                          x: {
                            format: 'dd/MM/yy HH:mm'
                          },
                        }
                      });
                
                      chart.render();
                    }
                
                    // Initial chart render
                    document.addEventListener("DOMContentLoaded", () => {
                      // Load the chart for Today by default
                      selectReport('This Week');
                    });
                  </script>
                  <!-- End Line Chart -->

                </div>

              </div>
            </div><!-- End Reports -->
            <!-- Top Selling -->
            <div class="col-12">
              <div class="card top-selling overflow-auto">

                <div class="filter">
                  <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                  <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                    <li class="dropdown-header text-start">
                      <h6>Filter</h6>
                    </li>
                    <li><button class="dropdown-item" type="button" onclick="selectTop('Today')">Today</button></li>
                    <li><button class="dropdown-item" type="button" onclick="selectTop('This Week')">This Week</button></li>
                    <li><button class="dropdown-item" type="button" onclick="selectTop('This Month')">This Month</button></li>
                  </ul>
                </div>

                <div class="card-body pb-0">
                  <h5 class="card-title top-title">Top Selling <span>| This Month</span></h5>

                  <table class="table table-borderless">
                    <thead>
                      <tr>
                        <th scope="col">Preview</th>
                        <th scope="col">Product</th>
                        <th scope="col">Price</th>
                        <th scope="col">Sold</th>
                        <th scope="col">Revenue</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th scope="row"><a href="#"><img src={% static 'assets/img/product-1.jpg' %} alt=""></a></th>
                        <td><a href="#" class="text-primary fw-bold">Ut inventore ipsa voluptas nulla</a></td>
                        <td>à§³64</td>
                        <td class="fw-bold">124</td>
                        <td>à§³5,828</td>
                      </tr>
                      <tr>
                        <th scope="row"><a href="#"><img src={% static 'assets/img/product-2.jpg' %} alt=""></a></th>
                        <td><a href="#" class="text-primary fw-bold">Exercitationem similique doloremque</a></td>
                        <td>à§³46</td>
                        <td class="fw-bold">98</td>
                        <td>à§³4,508</td>
                      </tr>
                      <tr>
                        <th scope="row"><a href="#"><img src={% static 'assets/img/product-3.jpg' %} alt=""></a></th>
                        <td><a href="#" class="text-primary fw-bold">Doloribus nisi exercitationem</a></td>
                        <td>à§³59</td>
                        <td class="fw-bold">74</td>
                        <td>à§³4,366</td>
                      </tr>
                      <tr>
                        <th scope="row"><a href="#"><img src={% static 'assets/img/product-4.jpg' %} alt=""></a></th>
                        <td><a href="#" class="text-primary fw-bold">Officiis quaerat sint rerum error</a></td>
                        <td>à§³32</td>
                        <td class="fw-bold">63</td>
                        <td>à§³2,016</td>
                      </tr>
                      <tr>
                        <th scope="row"><a href="#"><img src={% static 'assets/img/product-5.jpg' %} alt=""></a></th>
                        <td><a href="#" class="text-primary fw-bold">Sit unde debitis delectus repellendus</a></td>
                        <td>à§³79</td>
                        <td class="fw-bold">41</td>
                        <td>à§³3,239</td>
                      </tr>
                    </tbody>
                  </table>

                </div>

              </div>
            </div><!-- End Top Selling -->

          </div>
        </div><!-- End Left side columns -->

      </div>
    </section>

  </main><!-- End #main -->
{% endblock main %}

{% block scripts %}
<script>
  $("#statistics").removeClass("collapsed");
</script>

<script>
  function selectSales(value) {
    const cardTitle = document.querySelector(".sales-title");
    const cardTotal = document.querySelector(".sales-total");
    cardTitle.innerHTML = `Sales <span>| ${value}</span>`;
    if (value == "Today") {cardTotal.innerHTML = {{ daily.total_sales|escapejs }};}
    if (value == "This Week") {cardTotal.innerHTML = {{ weekly.total_sales|escapejs }};}
    if (value == "This Month") {cardTotal.innerHTML = {{ monthly.total_sales|escapejs }};}
  }

  function selectRevenue(value) {
    const cardTitle = document.querySelector(".revenue-title");
    const cardTotal = document.querySelector(".revenue-total");
    cardTitle.innerHTML = `Revenue <span>| ${value}</span>`;
    if (value == "Today") {cardTotal.innerHTML = {{ daily.total_revenue|escapejs }};}
    if (value == "This Week") {cardTotal.innerHTML = {{ weekly.total_revenue|escapejs }};}
    if (value == "This Month") {cardTotal.innerHTML = {{ monthly.total_revenue|escapejs }};}
  }
  
  function selectCustomer(value) {
    const cardTitle = document.querySelector(".customer-title");
    const cardTotal = document.querySelector(".customer-total");
    cardTitle.innerHTML = `Customer <span>| ${value}</span>`;
    if (value == "Today") {cardTotal.innerHTML = {{ daily.total_customer|escapejs }};}
    if (value == "This Week") {cardTotal.innerHTML = {{ weekly.total_customer|escapejs }};}
    if (value == "This Month") {cardTotal.innerHTML = {{ monthly.total_customer|escapejs }};}
  }
</script>
{% endblock scripts %}